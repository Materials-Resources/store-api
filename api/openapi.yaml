openapi: 3.0.3
info:
  title: Materials Resources Store APIs
  description: APIs for the Materials Resources Store designed specifically for the accompanying web application
  version: 1.0.0
tags:
  - name: account
    description: Account operations such as order and invoice management
  - name: orders
    description: Order operations for customers
  - name: products
    description: Product operations related to finding and viewing products
servers:
  - url: http://localhost:8080
    description: Local development server

security:
  - BearerAuth: []
paths:
  /account/branch:
    put:
      summary: Set active branch for current user
      operationId: setActiveBranch
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - branch_id
              properties:
                branch_id:
                  type: string
                  description: ID of the branch to set as active
      responses:
        '200':
          description: Branch successfully set
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Active branch updated successfully"
        '400':
          description: Invalid branch ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        '403':
          description: User does not have access to this branch
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          description: General Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /account/branches/active:
    get:
      summary: Get active branch for user
      operationId: getActiveBranches
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                required:
                  - branch
                type: object
                properties:
                  branch:
                    $ref: '#/components/schemas/Branch'
        default:
          description: General Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /account/branches:
    get:
      summary: Get available branches for customer
      operationId: listCustomerBranches
      parameters:
        - name: contact_id
          in: query
          required: true
          schema:
              type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  branches:
                    type: array
                    items:
                      $ref: '#/components/schemas/Branch'

        default:
          description: General Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /account/orders:
    get:
      tags:
        - account
      summary: Get a list of orders
      operationId: listOrders
      parameters:
        - name: page
          in: query
          required: true
          schema:
            type: integer
        - name: page_size
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: "List of order summaries for account"
          content:
            application/json:
              schema:
                type: object
                required:
                  - total_records
                  - orders
                properties:
                  total_records:
                    type: integer
                  orders:
                    type: array
                    items:
                      $ref: '#/components/schemas/OrderSummary'

        default:
          description: General Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /account/orders/{id}:
    get:
      operationId: getOrder
      tags:
        - account
      summary: Get an order by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: "Order Details"
          content:
            application/json:
              schema:
                type: object
                properties:
                  order:
                    $ref: '#/components/schemas/Order'
                required:
                  - order
        '401':
          description: "Unauthorized"
        '404':
          description: Not Found
        default:
          description: General Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /account/quotes:
    post:
      summary: Create a new quote
      operationId: createQuote
      tags:
        - account
      description: |
        Create a new quote. The `customer_id` and `contact_id` are extracted from the provided authentication token. Make sure to include a valid bearer token in the `Authorization` header.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - purchase_order
                - delivery_instructions
                - date_requested
                - items
              properties:
                purchase_order:
                  type: string
                delivery_instructions:
                  type: string
                date_requested:
                  type: string
                  format: date-time
                  description: Date of the request.  Should be in YYYY-MM-DD format (ISO 8601).
                items:
                  type: array
                  description: List of items for the quote
                  items:
                    type: object
                    required:
                      - product_id
                      - quantity
                    properties:
                      product_id:
                        type: string
                        description: ID of the product
                      quantity:
                        type: number
                        x-go-type: float64
                        description: Quantity of the product
      responses:
        '201':
          description: Quote successfully created
          content:
            application/json:
              schema:
                required:
                  - quote_id
                type: object
                properties:
                  quote_id:
                    type: string
                    description: ID of the created quote
                  status:
                    type: string
                    description: Status of the quote creation

        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    description: List of validation errors
                    items:
                      type: object
                      properties:
                        field:
                          type: string
                          description: The field where the validation error occurred
                        message:
                          type: string
                          description: A descriptive error message
        default:
          description: General Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    get:
      tags:
        - account
      summary: Get a list of quotes
      operationId: listQuotes
      parameters:
        - name: page
          in: query
          required: true
          schema:
            type: integer
        - name: page_size
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: "List of quote summaries for account"
          content:
            application/json:
              schema:
                type: object
                required:
                  - total_records
                  - quotes
                properties:
                  total_records:
                    type: integer
                  quotes:
                    type: array
                    items:
                      $ref: '#/components/schemas/QuoteSummary'
        default:
          description: General Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /account/quotes/{id}:
    get:
      summary: Get quote by ID
      operationId: getQuote
      tags:
        - account
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                required:
                  - quote
                properties:
                  quote:
                    $ref: '#/components/schemas/Quote'
        default:
          description: General Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /products/{id}:
    get:
      summary: Get a product by ID
      security: []
      operationId: getProduct
      tags:
        - products
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  product:
                    $ref: '#/components/schemas/Product'
                required:
                  - product
        '404':
          description: Not Found
        default:
          description: General Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"


  /search/products:
    post:
      security: []
      tags:
      - products
      operationId: searchProducts
      summary: Search for products
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sort_by:
                  type: string
                filters:
                  type: object
                  additionalProperties:
                    type: array
                    items:
                      type: string
                page:
                  type: integer
                query:
                  type: string
      responses:
        '200':
          description: "Search results"
          content:
            application/json:
              schema:
                required:
                  - metadata
                  - products
                  - aggregations
                type: object
                properties:
                  aggregations:
                    type: array
                    items:
                      $ref: '#/components/schemas/Aggregation'
                  metadata:
                    $ref: '#/components/schemas/PageMetadata'
                  products:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'
        default:
          description: General Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    RecommendedProduct:
      type: object
      required:
        - id
        - name
        - sn
        - relevance_score
      properties:
        id:
          type: string
        name:
          type: string
        sn:
          type: string
        relevance_score:
          type: number
          format: float
        customer_price:
          type: number
          format: float
    ShipmentSimplified:
      required:
        - id
        - order_id
        - invoice_id
        - carrier_name
        - carrier_tracking
      type: object
      properties:
        id:
          type: string
        order_id:
          type: string
        invoice_id:
          type: string
        carrier_name:
          type: string
        carrier_tracking:
          type: string
    InvoiceSimplified:
      required:
        - id
        - order_id
        - created_at
        - total
        - amount_paid
      type: object
      properties:
        id:
          type: string
        order_id:
          type: string
        created_at:
          type: string
        total:
          x-go-type: float64
          type: number
        amount_paid:
          x-go-type: float64
          type: number
    Address:
      required:
        - id
        - name
        - line_one
        - line_two
        - city
        - state
        - postal_code
        - country
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        line_one:
          type: string
        line_two:
          type: string
        city:
          type: string
        state:
          type: string
        postal_code:
          type: string
        country:
          type: string
    Branch:
      required:
        - id
        - name
      type: object
      properties:
        id:
          type: string
        name:
          type: string
    PageMetadata:
      required:
        - total_pages
        - total_records
      type: object
      properties:
        total_pages:
          type: integer
        total_records:
          type: integer
    Bucket:
      type: object
      required:
        - value
        - count
      properties:
        value:
          type: string
        count:
          type: integer
    SearchMetadataFacet:
      required:
        - attribute
        - options
      type: object
      properties:
        attribute:
          type: string
        options:
          type: array
          items:
            $ref: '#/components/schemas/SearchMetadataFacetOption'
    SearchMetadataFacetOption:
      required:
        - value
        - count
      type: object
      properties:
        value:
          type: string
        count:
          type: integer
    OrderStatus:
      type: string
      enum:
        - unspecified
        - approved
        - completed
        - cancelled
        - pending_approval
    Order:
      required:
        - id
        - contact_id
        - branch_id
        - purchase_order
        - status
        - date_created
        - date_requested
        - delivery_instructions
        - shipping_address
        - items
        - total
      type: object
      properties:
        id:
          type: string
        contact_id:
          type: string
        branch_id:
          type: string
        purchase_order:
          type: string
        status:
          $ref: '#/components/schemas/OrderStatus'
        date_created:
          type: string
          format: date-time
        date_requested:
          type: string
          format: date-time
        taker:
          type: string
        delivery_instructions:
          type: string
        shipping_address:
          $ref: '#/components/schemas/Address'
        total:
          x-go-type: float64
          type: number
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
    OrderItem:
      required:
        - product_sn
        - product_name
        - product_id
        - customer_product_sn
        - ordered_quantity
        - shipped_quantity
        - unit_type
        - unit_price
        - total_price
        - back_ordered_quantity
      type: object
      properties:
        product_sn:
          type: string
        product_name:
          type: string
        product_id:
          type: string
        customer_product_sn:
          type: string
        ordered_quantity:
          x-go-type: float64
          type: number
        shipped_quantity:
          x-go-type: float64
          type: number
        unit_type:
          type: string
        unit_price:
          x-go-type: float64
          type: number
        total_price:
          x-go-type: float64
          type: number

        back_ordered_quantity:
          x-go-type: float64
          type: number
    OrderSummary:
      required:
        - id
        - contact_id
        - branch_id
        - purchase_order
        - status
        - date_created
        - date_requested
      type: object
      properties:
        id:
          type: string
        contact_id:
          type: string
        branch_id:
          type: string
        purchase_order:
          type: string
        status:
          $ref: '#/components/schemas/OrderStatus'
        date_created:
          type: string
          format: date-time
        date_requested:
          type: string
          format: date-time
    QuoteStatus:
      type: string
      enum:
        - unspecified
        - pending_approval
        - approved
        - cancelled
        - expired
    QuoteSummary:
      required:
        - id
        - contact_id
        - branch_id
        - purchase_order
        - status
        - date_created
        - date_expires
      type: object
      properties:
        id:
          type: string
        contact_id:
          type: string
        branch_id:
          type: string
        purchase_order:
          type: string
        status:
          $ref: '#/components/schemas/QuoteStatus'
        date_created:
          type: string
          format: date-time
        date_expires:
          type: string
          format: date-time
    Quote:
      required:
        - id
        - purchase_order
        - status
        - date_created
        - date_expires
        - items
      type: object
      properties:
        id:
          type: string
        purchase_order:
          type: string
        date_created:
          type: string
          format: date-time
        date_expires:
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/QuoteStatus'
        items:
          type: array
          items:
            $ref: '#/components/schemas/QuoteItem'
    QuoteItem:
      required:
        - product_id
        - product_sn
        - product_name
        - customer_product_sn
        - ordered_quantity
        - unit_type
        - unit_price
        - total_price
      type: object
      properties:
        product_id:
          type: string
        product_sn:
          type: string
        product_name:
          type: string
        customer_product_sn:
          type: string
        ordered_quantity:
          type: number
          x-go-type: float64
        unit_type:
          type: string
        unit_price:
          type: number
          x-go-type: float64
        total_price:
          type: number
          x-go-type: float64
    Product:
      required:
        - id
        - sn
        - name
        - product_group_sn
        - product_group_name
      type: object
      properties:
        id:
          type: string
        sn:
          type: string
        name:
          type: string
        description:
          type: string
        product_group_sn:
          type: string
        product_group_name:
          type: string
        image_url:
          type: string
    ProductSearchResult:
      allOf:
        - $ref: '#/components/schemas/Product'
    Aggregation:
      oneOf:
        - $ref: '#/components/schemas/RangeAggregation'
        - $ref: '#/components/schemas/TermsAggregation'
      discriminator:
        propertyName: objectType
    AggregationCommonProperties:
      required:
        - field_name
      type: object
      properties:
        field_name:
          type: string
    RangeAggregation:
      allOf:
        - "$ref": '#/components/schemas/AggregationCommonProperties'
        - type: object

    TermsAggregation:
      required:
        - buckets
      allOf:
        - "$ref": '#/components/schemas/AggregationCommonProperties'
        - type: object
          properties:
            buckets:
              type: array
              items:
                $ref: '#/components/schemas/TermsAggregationBucket'
    TermsAggregationBucket:
      required:
        - key
        - count
      type: object
      properties:
        key:
          type: string
        count:
          type: integer
    Customer:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: "string"
        name:
          type: "string"
    Error:
      description: Represents error object
      type: object
      properties:
        code:
          type: integer
          format: int64
        message:
          type: string
      required:
        - code
        - message

